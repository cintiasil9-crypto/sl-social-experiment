<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 14px;
}

input, select {
  padding: 8px;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  font-size: 13px;
  text-align: left;
  white-space: nowrap;
}

th {
  background: #e9ecef;
  position: sticky;
  top: 0;
  z-index: 3;
}

/* Sticky rank + name */
.sticky {
  position: sticky;
  left: 0;
  background: #fff;
  z-index: 2;
}
.sticky.name {
  left: 40px;
}

/* Column groups */
.meta { background: #ffffff; }
.trait { background: #f7fbff; }
.style { background: #fff7f7; }

/* Bars */
.bar {
  height: 8px;
  background: #ddd;
  border-radius: 4px;
  overflow: hidden;
}
.fill {
  height: 100%;
  background: linear-gradient(90deg,#4caf50,#81c784);
}

.bad {
  color: #b00020;
  font-weight: bold;
}
</style>
</head>

<body>

<h1 id="title">üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar name‚Ä¶">
  <select id="mode">
    <option value="overall">Overall</option>

    <option value="engaging">Most Engaging</option>
    <option value="curious">Most Curious</option>
    <option value="humorous">Funniest</option>
    <option value="supportive">Most Supportive</option>
    <option value="dominant">Most Dominant</option>
    <option value="combative">Most Combative</option>

    <option value="flirty">Most Flirty</option>
    <option value="sexual">Most Sexual</option>
    <option value="curse">Most Profane</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th class="sticky meta">#</th>
  <th class="sticky name meta">Name</th>

  <th class="meta">Confidence</th>
  <th class="meta">Reputation</th>
  <th class="meta">Gravity</th>
  <th class="meta">Role</th>
  <th class="meta">Archetype</th>

  <th class="trait">Engaging</th>
  <th class="trait">Curious</th>
  <th class="trait">Humorous</th>
  <th class="trait">Supportive</th>
  <th class="trait">Dominant</th>
  <th class="trait">Combative</th>

  <th class="style">Flirty</th>
  <th class="style">Sexual</th>
  <th class="style">Curse</th>

  <th class="meta">Troll</th>
</tr>
</thead>

<tbody id="rows">
<tr><td colspan="18">Loading‚Ä¶</td></tr>
</tbody>
</table>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA = [];

fetch(API)
  .then(r => r.json())
  .then(json => {
    DATA = json;
    renderOverall();
  });

document.getElementById("search").addEventListener("input", applyFilters);
document.getElementById("mode").addEventListener("change", applyFilters);

function bar(v=0) {
  return `
    <div class="bar">
      <div class="fill" style="width:${v}%"></div>
    </div>
  `;
}

function applyFilters() {
  const q = document.getElementById("search").value.toLowerCase();
  const mode = document.getElementById("mode").value;

  let list = DATA.filter(p => p.name.toLowerCase().includes(q));

  if (mode === "overall") {
    renderOverall(list);
  } else {
    rankByTrait(list, mode);
  }
}

function renderOverall(list = DATA) {
  document.getElementById("title").innerText =
    "üèÜ SL Social Experiment Leaderboard";

  render(list);
}

function rankByTrait(list, trait) {
  document.getElementById("title").innerText =
    "üèÜ " + document.querySelector(`#mode option[value="${trait}"]`).text;

  let filtered = list.filter(p =>
    (p.traits?.[trait] || p.styles?.[trait]) > 0
  );

  filtered.sort((a,b) => {
    const av = a.traits?.[trait] ?? a.styles?.[trait] ?? 0;
    const bv = b.traits?.[trait] ?? b.styles?.[trait] ?? 0;
    return bv - av;
  });

  filtered = filtered.map((p,i)=>({...p, rank:i+1}));
  render(filtered);
}

function render(list) {
  const body = document.getElementById("rows");
  body.innerHTML = "";

  list.forEach(p => {
    const t = p.traits || {};
    const s = p.styles || {};

    body.innerHTML += `
<tr>
  <td class="sticky meta">${p.rank}</td>
  <td class="sticky name meta">${p.name}</td>

  <td class="meta">${p.confidence}%</td>
  <td class="meta">${p.reputation}%</td>
  <td class="meta">${p.gravity}%</td>
  <td class="meta">${p.role}</td>
  <td class="meta">${p.archetype}</td>

  <td class="trait">${bar(t.engaging)} ${t.engaging||0}%</td>
  <td class="trait">${bar(t.curious)} ${t.curious||0}%</td>
  <td class="trait">${bar(t.humorous)} ${t.humorous||0}%</td>
  <td class="trait">${bar(t.supportive)} ${t.supportive||0}%</td>
  <td class="trait">${bar(t.dominant)} ${t.dominant||0}%</td>
  <td class="trait">${bar(t.combative)} ${t.combative||0}%</td>

  <td class="style">${bar(s.flirty)} ${s.flirty||0}%</td>
  <td class="style">${bar(s.sexual)} ${s.sexual||0}%</td>
  <td class="style">${bar(s.curse)} ${s.curse||0}%</td>

  <td class="meta ${p.troll ? "bad" : ""}">
    ${p.troll ? "‚ö†Ô∏è" : ""}
  </td>
</tr>`;
  });
}
</script>

</body>
</html>
