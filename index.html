<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

/* ===== CONTROLS ===== */
.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 14px;
  align-items: center;
}

input, select, button {
  padding: 8px 10px;
  font-size: 14px;
}

button {
  cursor: pointer;
  border: none;
  background: #444;
  color: #fff;
  border-radius: 4px;
}
button:hover {
  background: #000;
}

#backBtn {
  display: none;
  background: #1976d2;
}
#backBtn:hover {
  background: #0d47a1;
}

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  font-size: 13px;
  white-space: nowrap;
}

th {
  position: sticky;
  top: 0;
  z-index: 3;
}

/* Sticky columns */
.sticky {
  position: sticky;
  left: 0;
  z-index: 2;
}
.sticky.name {
  left: 40px;
}

/* ===== COLOR GROUPS ===== */

/* Rank + Name */
.meta {
  background: #ffffff;
}

/* Confidence / Reputation / Gravity */
.stats {
  background: #e3f2fd;
}

/* Role / Archetype */
.identity {
  background: #ede7f6;
}

/* Traits */
.trait {
  background: #e8f5e9;
}

/* Modifiers */
.style {
  background: #fce4ec;
}

/* Troll */
.troll {
  background: #ffebee;
  font-weight: bold;
  text-align: center;
}

/* ===== BARS ===== */
.bar {
  height: 8px;
  background: #ccc;
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 2;
}

.fill-trait {
  height: 100%;
  background: linear-gradient(90deg,#43a047,#81c784);
}

.fill-style {
  height: 100%;
  background: linear-gradient(90deg,#d81b60,#f48fb1);
}

.bad {
  color: #b00020;
}
</style>
</head>

<body>

<h1 id="title">üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar name‚Ä¶">

  <select id="mode">
    <option value="overall">Overall</option>
    <option value="engaging">Most Engaging</option>
    <option value="curious">Most Curious</option>
    <option value="humorous">Funniest</option>
    <option value="supportive">Most Supportive</option>
    <option value="dominant">Most Dominant</option>
    <option value="combative">Most Combative</option>
    <option value="flirty">Most Flirty</option>
    <option value="sexual">Most Sexual</option>
    <option value="curse">Most Profane</option>
  </select>

  <button id="backBtn">‚¨Ö Back to Main</button>
</div>

<table>
<thead>
<tr>
  <th class="sticky meta">#</th>
  <th class="sticky name meta">Name</th>

  <th class="stats">Confidence</th>
  <th class="stats">Reputation</th>
  <th class="stats">Gravity</th>

  <th class="identity">Role</th>
  <th class="identity">Archetype</th>

  <th class="trait">Engaging</th>
  <th class="trait">Curious</th>
  <th class="trait">Humorous</th>
  <th class="trait">Supportive</th>
  <th class="trait">Dominant</th>
  <th class="trait">Combative</th>

  <th class="style">Flirty</th>
  <th class="style">Sexual</th>
  <th class="style">Curse</th>

  <th class="troll">Troll</th>
</tr>
</thead>

<tbody id="rows">
<tr><td colspan="18">Loading‚Ä¶</td></tr>
</tbody>
</table>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA = [];

fetch(API)
  .then(r => r.json())
  .then(json => {
    DATA = json;
    renderOverall();
  });

document.getElementById("search").addEventListener("input", applyFilters);
document.getElementById("mode").addEventListener("change", applyFilters);
document.getElementById("backBtn").addEventListener("click", () => {
  document.getElementById("mode").value = "overall";
  document.getElementById("search").value = "";
  renderOverall();
});

function bar(v=0, cls="fill-trait") {
  return `
    <div class="bar">
      <div class="${cls}" style="width:${v}%"></div>
    </div>`;
}

function applyFilters() {
  const q = document.getElementById("search").value.toLowerCase();
  const mode = document.getElementById("mode").value;

  let list = DATA.filter(p => p.name.toLowerCase().includes(q));

  if (mode === "overall") {
    renderOverall(list);
  } else {
    rankByTrait(list, mode);
  }
}

function renderOverall(list = DATA) {
  document.getElementById("title").innerText =
    "üèÜ SL Social Experiment Leaderboard";
  document.getElementById("backBtn").style.display = "none";
  render(list);
}

function rankByTrait(list, trait) {
  document.getElementById("title").innerText =
    "üèÜ " + document.querySelector(`#mode option[value="${trait}"]`).text;
  document.getElementById("backBtn").style.display = "inline-block";

  let filtered = list.filter(p =>
    (p.traits?.[trait] || p.styles?.[trait]) > 0
  );

  filtered.sort((a,b) => {
    const av = a.traits?.[trait] ?? a.styles?.[trait] ?? 0;
    const bv = b.traits?.[trait] ?? b.styles?.[trait] ?? 0;
    return bv - av;
  });

  filtered = filtered.map((p,i)=>({...p, rank:i+1}));
  render(filtered);
}

function render(list) {
  const body = document.getElementById("rows");
  body.innerHTML = "";

  list.forEach(p => {
    const t = p.traits || {};
    const s = p.styles || {};

    body.innerHTML += `
<tr>
  <td class="sticky meta">${p.rank}</td>
  <td class="sticky name meta">${p.name}</td>

  <td class="stats">${p.confidence}%</td>
  <td class="stats">${p.reputation}%</td>
  <td class="stats">${p.gravity}%</td>

  <td class="identity">${p.role}</td>
  <td class="identity">${p.archetype}</td>

  <td class="trait">${bar(t.engaging)} ${t.engaging||0}%</td>
  <td class="trait">${bar(t.curious)} ${t.curious||0}%</td>
  <td class="trait">${bar(t.humorous)} ${t.humorous||0}%</td>
  <td class="trait">${bar(t.supportive)} ${t.supportive||0}%</td>
  <td class="trait">${bar(t.dominant)} ${t.dominant||0}%</td>
  <td class="trait">${bar(t.combative)} ${t.combative||0}%</td>

  <td class="style">${bar(s.flirty,"fill-style")} ${s.flirty||0}%</td>
  <td class="style">${bar(s.sexual,"fill-style")} ${s.sexual||0}%</td>
  <td class="style">${bar(s.curse,"fill-style")} ${s.curse||0}%</td>

  <td class="troll ${p.troll ? "bad" : ""}">
    ${p.troll ? "‚ö†Ô∏è" : ""}
  </td>
</tr>`;
  });
}
</script>

</body>
</html>
