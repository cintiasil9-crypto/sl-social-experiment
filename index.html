<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 12px;
}

/* ===== CONTROLS ===== */
.controls {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

input, select {
  padding: 7px 10px;
  font-size: 14px;
}

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  font-size: 13px;
  white-space: nowrap;
}

th {
  position: sticky;
  top: 0;
  background: #fafafa;
  z-index: 3;
}

/* Sticky columns */
.sticky { position: sticky; background:#fff; z-index:2; }
.sticky.rank { left:0; }
.sticky.name { left:40px; }

/* Coloring */
.meta { background:#e3f2fd; }
.summary { background:#fffde7; max-width:260px; white-space:normal; }
.trait { background:#e8f5e9; }
.style { background:#fce4ec; }
.energy { background:#ede7f6; }
.risk { background:#ffebee; text-align:center; }

/* Bars */
.bar {
  height: 8px;
  background: #ccc;
  border-radius: 4px;
  overflow: hidden;
}
.fill-trait { background:#66bb6a; height:100%; }
.fill-style { background:#ec407a; height:100%; }
.fill-energy { background:#7e57c2; height:100%; }

/* Tooltips */
[data-tip] {
  position: relative;
  cursor: help;
}
[data-tip]:hover::after {
  content: attr(data-tip);
  position: absolute;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 6px 8px;
  border-radius: 6px;
  font-size: 12px;
  white-space: normal;
  width: 220px;
  z-index: 999;
}

/* Confidence fade */
.low-confidence { opacity:0.65; font-style:italic; }

/* Risk badges */
.badge {
  padding: 3px 7px;
  border-radius: 12px;
  font-size: 11px;
  color:#fff;
}
.safe { background:#2e7d32; }
.caution { background:#f9a825; }
.danger { background:#c62828; }

/* ===== PROFILE MODAL ===== */
#profile {
  position: fixed;
  top:0; right:-420px;
  width: 380px;
  height:100%;
  background:#fff;
  box-shadow:-3px 0 12px rgba(0,0,0,.3);
  padding:16px;
  transition:.3s;
  overflow:auto;
  z-index:9999;
}
#profile.open { right:0; }
#profile h2 { margin-top:0; }
.close {
  float:right;
  cursor:pointer;
  font-size:18px;
}
.section { margin-bottom:12px; }
.small { font-size:12px; color:#666; }
</style>
</head>

<body>

<h1>üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar‚Ä¶">
  <select id="mode">
    <option value="overall">Overall</option>
    <option value="engaging">Engaging</option>
    <option value="humorous">Humorous</option>
    <option value="supportive">Supportive</option>
    <option value="dominant">Dominant</option>
    <option value="flirty">Flirty</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th class="sticky rank">#</th>
  <th class="sticky name">Name</th>
  <th class="meta" data-tip="How much data we have on this avatar">Confidence</th>
  <th class="summary">Summary</th>

  <th class="trait" data-tip="Conversation pull & social momentum">Engaging</th>
  <th class="trait" data-tip="Questions, curiosity, exploration">Curious</th>
  <th class="trait" data-tip="Jokes, laughter, playful tone">Humorous</th>
  <th class="trait" data-tip="Empathy & reassurance">Supportive</th>
  <th class="trait" data-tip="Commands, presence, control">Dominant</th>
  <th class="trait" data-tip="Confrontation & edge">Combative</th>

  <th class="style" data-tip="Playful flirt energy">Flirty</th>
  <th class="style" data-tip="Explicit language">Sexual</th>
  <th class="style" data-tip="Swearing intensity">Curse</th>

  <th class="energy" data-tip="High-energy social environments">Club</th>
  <th class="energy" data-tip="Low-pressure conversation spaces">Hangout</th>

  <th class="risk" data-tip="Likelihood of drama or disruption">Risk</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<!-- PROFILE PANEL -->
<div id="profile">
  <span class="close" onclick="closeProfile()">‚úñ</span>
  <div id="profileContent"></div>
</div>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA=[], MODE="overall";

fetch(API).then(r=>r.json()).then(d=>{ DATA=d; render(); });

search.oninput = render;
mode.onchange = e=>{ MODE=e.target.value; render(); };

function bar(v,cls){
  return `<div class="bar"><div class="${cls}" style="width:${v||0}%"></div></div>${v||0}%`;
}

function riskBadge(v){
  if(v>65) return `<span class="badge danger">Chaos</span>`;
  if(v>35) return `<span class="badge caution">Spicy</span>`;
  return `<span class="badge safe">Chill</span>`;
}

function render(){
  let q = search.value.toLowerCase();
  let list = DATA.filter(p=>p.name.toLowerCase().includes(q));

  rows.innerHTML="";
  list.forEach(p=>{
    let t=p.traits||{}, s=p.styles||{};
    let fade=p.confidence<25?"low-confidence":"";

    rows.innerHTML+=`
<tr class="${fade}">
<td class="sticky rank">${p.rank}</td>
<td class="sticky name"><a href="#" onclick='openProfile(${JSON.stringify(p).replace(/'/g,"&apos;")})'>${p.name}</a></td>
<td class="meta">${p.confidence}%</td>
<td class="summary">${p.summary||"‚Äî"}</td>

<td class="trait">${bar(t.engaging,"fill-trait")}</td>
<td class="trait">${bar(t.curious,"fill-trait")}</td>
<td class="trait">${bar(t.humorous,"fill-trait")}</td>
<td class="trait">${bar(t.supportive,"fill-trait")}</td>
<td class="trait">${bar(t.dominant,"fill-trait")}</td>
<td class="trait">${bar(t.combative,"fill-trait")}</td>

<td class="style">${bar(s.flirty,"fill-style")}</td>
<td class="style">${bar(s.sexual,"fill-style")}</td>
<td class="style">${bar(s.curse,"fill-style")}</td>

<td class="energy">${bar(p.club_energy,"fill-energy")}</td>
<td class="energy">${bar(p.hangout_energy,"fill-energy")}</td>

<td class="risk">${riskBadge(p.risk)}</td>
</tr>`;
  });
}

function openProfile(p){
  profile.classList.add("open");
  profileContent.innerHTML=`
<h2>${p.name}</h2>
<div class="section"><b>Summary</b><br>${p.summary}</div>
<div class="section"><b>Vibe right now</b><br>${p.vibe}</div>
<div class="section"><b>Confidence</b>: ${p.confidence}%</div>
<div class="section"><b>Risk</b>: ${riskBadge(p.risk)}</div>
<div class="section small">Scores stabilize as more data is observed.</div>`;
}

function closeProfile(){
  profile.classList.remove("open");
}
</script>

</body>
</html>
