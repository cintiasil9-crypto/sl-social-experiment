<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f4f6f8; padding:20px; }
h1 { text-align:center; margin-bottom:12px; }

.controls {
  display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;
}

input, select, button {
  padding:7px 10px; font-size:14px;
}

button {
  cursor:pointer; border:none; background:#444; color:#fff; border-radius:4px;
}
button:hover { background:#000; }
button.active { background:#1976d2; }

table {
  width:100%; border-collapse:collapse; background:#fff;
}
th, td {
  border:1px solid #ddd; padding:6px; font-size:13px; white-space:nowrap;
}
th {
  position:sticky; top:0; background:#fafafa; z-index:3;
}

.sticky { position:sticky; background:#fff; z-index:2; }
.sticky.rank { left:0; }
.sticky.check { left:36px; }
.sticky.name { left:76px; }

.meta { background:#e3f2fd; }
.summary { background:#fffde7; white-space:normal; max-width:260px; }
.trait { background:#e8f5e9; }
.style { background:#fce4ec; }
.energy { background:#ede7f6; }
.risk { background:#ffebee; text-align:center; }

.bar {
  height:8px; background:#ccc; border-radius:4px; overflow:hidden;
}
.fill-trait { height:100%; background:#66bb6a; }
.fill-style { height:100%; background:#ec407a; }
.fill-energy { height:100%; background:#7e57c2; }

.low-confidence { opacity:.6; font-style:italic; }

.badge {
  padding:3px 7px; border-radius:12px; font-size:11px; color:#fff;
}
.safe { background:#2e7d32; }
.caution { background:#f9a825; }
.danger { background:#c62828; }

/* TOOLTIP */
[data-tip] { position:relative; cursor:help; }
[data-tip]:hover::after {
  content:attr(data-tip);
  position:absolute;
  bottom:120%; left:50%; transform:translateX(-50%);
  background:#333; color:#fff;
  padding:6px 8px; border-radius:6px;
  font-size:12px; width:220px; white-space:normal;
  z-index:999;
}

/* COMPARE PANEL */
#comparePanel {
  display:none;
  margin-top:16px;
  background:#fff;
  border:2px solid #1976d2;
  padding:12px;
}
#comparePanel h2 { margin-top:0; }

.compare-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap:12px;
}

.card {
  border:1px solid #ddd;
  padding:10px;
  background:#fafafa;
}
.card h3 { margin:0 0 6px 0; }
.small { font-size:12px; color:#666; }

/* WEEKLY */
#weekly {
  margin-top:20px;
  background:#fff;
  padding:12px;
  border:1px solid #ddd;
}
</style>
</head>

<body>

<h1>üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar‚Ä¶">

  <select id="mode">
    <option value="overall">Overall</option>
    <option value="engaging">Engaging</option>
    <option value="curious">Curious</option>
    <option value="humorous">Humorous</option>
    <option value="supportive">Supportive</option>
    <option value="dominant">Dominant</option>
    <option value="combative">Combative</option>
    <option value="flirty">Flirty</option>
    <option value="risk">Risk</option>
  </select>

  <button id="compareBtn">Compare</button>
  <button id="clearBtn">Clear Compare</button>
</div>

<table>
<thead>
<tr>
  <th class="sticky rank">#</th>
  <th class="sticky check">‚úì</th>
  <th class="sticky name">Name</th>

  <th class="meta" data-tip="How much data we have">Confidence</th>
  <th class="meta" data-tip="Current energy (last ~45 min)">Vibe</th>
  <th class="summary">Summary</th>

  <th class="trait" data-tip="Conversation pull">Engaging</th>
  <th class="trait" data-tip="Questions & curiosity">Curious</th>
  <th class="trait" data-tip="Jokes & playfulness">Humorous</th>
  <th class="trait" data-tip="Empathy & reassurance">Supportive</th>
  <th class="trait" data-tip="Presence & commands">Dominant</th>
  <th class="trait" data-tip="Confrontation">Combative</th>

  <th class="style">Flirty</th>
  <th class="style">Sexual</th>
  <th class="style">Curse</th>

  <th class="energy">Club</th>
  <th class="energy">Hangout</th>

  <th class="risk">Risk</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<!-- COMPARE PANEL -->
<div id="comparePanel">
  <h2>üîç Compare Avatars</h2>
  <div class="compare-grid" id="compareGrid"></div>
</div>

<!-- WEEKLY -->
<div id="weekly">
  <h2>üèÖ Weekly Standouts</h2>
  <div id="weeklyContent"></div>
</div>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA=[], MODE="overall", COMPARE=false;
let SELECTED = new Set();

fetch(API).then(r=>r.json()).then(d=>{
  DATA=d;
  render();
  renderWeekly();
});

search.oninput = render;
mode.onchange = e=>{ MODE=e.target.value; render(); };

compareBtn.onclick = ()=>{
  COMPARE=!COMPARE;
  compareBtn.classList.toggle("active",COMPARE);
  document.getElementById("comparePanel").style.display = COMPARE ? "block" : "none";
  render();
};

clearBtn.onclick = ()=>{
  SELECTED.clear();
  render();
};

function bar(v,cls){
  return `<div class="bar"><div class="${cls}" style="width:${v||0}%"></div></div>${v||0}%`;
}
function riskBadge(v){
  if(v>65) return `<span class="badge danger">Chaos</span>`;
  if(v>35) return `<span class="badge caution">Spicy</span>`;
  return `<span class="badge safe">Chill</span>`;
}

function render(){
  let q=search.value.toLowerCase();
  let list=DATA.filter(p=>p.name.toLowerCase().includes(q));

  if (MODE!=="overall") {
    list=list.sort((a,b)=>((b.traits?.[MODE]??b[MODE]??0)-(a.traits?.[MODE]??a[MODE]??0)));
  }

  rows.innerHTML="";
  list.forEach((p,i)=>{
    let t=p.traits||{}, s=p.styles||{};
    let fade=p.confidence<25?"low-confidence":"";

    rows.innerHTML+=`
<tr class="${fade}">
<td class="sticky rank">${i+1}</td>
<td class="sticky check">
<input type="checkbox"
${SELECTED.has(p.name)?"checked":""}
${SELECTED.size>=4&&!SELECTED.has(p.name)?"disabled":""}
onchange="toggleSelect('${p.name}')">
</td>
<td class="sticky name">${p.name}</td>

<td class="meta">${p.confidence}%</td>
<td class="meta">${p.vibe}</td>
<td class="summary">${p.summary}</td>

<td class="trait">${bar(t.engaging,"fill-trait")}</td>
<td class="trait">${bar(t.curious,"fill-trait")}</td>
<td class="trait">${bar(t.humorous,"fill-trait")}</td>
<td class="trait">${bar(t.supportive,"fill-trait")}</td>
<td class="trait">${bar(t.dominant,"fill-trait")}</td>
<td class="trait">${bar(t.combative,"fill-trait")}</td>

<td class="style">${bar(s.flirty,"fill-style")}</td>
<td class="style">${bar(s.sexual,"fill-style")}</td>
<td class="style">${bar(s.curse,"fill-style")}</td>

<td class="energy">${bar(p.club_energy,"fill-energy")}</td>
<td class="energy">${bar(p.hangout_energy,"fill-energy")}</td>

<td class="risk">${riskBadge(p.risk)}</td>
</tr>`;
  });

  renderCompare();
}

function toggleSelect(name){
  if(SELECTED.has(name)) SELECTED.delete(name);
  else if(SELECTED.size<4) SELECTED.add(name);
  render();
}

function renderCompare(){
  if(!COMPARE) return;
  let grid=document.getElementById("compareGrid");
  grid.innerHTML="";
  DATA.filter(p=>SELECTED.has(p.name)).forEach(p=>{
    grid.innerHTML+=`
<div class="card">
<h3>${p.name}</h3>
<div class="small">${p.summary}</div>
<div><b>Vibe:</b> ${p.vibe}</div>
<div><b>Risk:</b> ${riskBadge(p.risk)}</div>
<div><b>Engaging</b>${bar(p.traits.engaging,"fill-trait")}</div>
<div><b>Humorous</b>${bar(p.traits.humorous,"fill-trait")}</div>
<div><b>Supportive</b>${bar(p.traits.supportive,"fill-trait")}</div>
<div><b>Dominant</b>${bar(p.traits.dominant,"fill-trait")}</div>
</div>`;
  });
}

function renderWeekly(){
  let top=(trait)=>DATA.reduce((a,b)=>b.traits[trait]>a.traits[trait]?b:a);
  weeklyContent.innerHTML=`
üèÜ Most Engaging: <b>${top("engaging").name}</b><br>
üé§ Funniest: <b>${top("humorous").name}</b><br>
ü´Ç Comfort Avatar: <b>${top("supportive").name}</b><br>
üòà Chaos Potential: <b>${DATA.reduce((a,b)=>b.risk>a.risk?b:a).name}</b>
`;
}
</script>

</body>
</html>
