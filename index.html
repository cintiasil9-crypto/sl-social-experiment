<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

h1 { text-align:center; }

.controls, .lens {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:12px;
}

input, select, button {
  padding:7px 10px;
  font-size:14px;
}

button {
  border:none;
  background:#444;
  color:#fff;
  border-radius:4px;
  cursor:pointer;
}
button:hover { background:#000; }

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
}

th, td {
  border:1px solid #ddd;
  padding:6px;
  font-size:13px;
  white-space:nowrap;
}

th {
  position:sticky;
  top:0;
  background:#fafafa;
  z-index:2;
}

.sticky.rank { left:0; position:sticky; background:#fff; }
.sticky.name { left:40px; position:sticky; background:#fff; }

.trait { background:#e8f5e9; }
.style { background:#fce4ec; }
.troll { background:#ffebee; text-align:center; }
.summary { max-width:380px; white-space:normal; }

.bar {
  height:8px;
  background:#ccc;
  border-radius:4px;
  overflow:hidden;
}
.fill-trait {
  height:100%;
  background:linear-gradient(90deg,#43a047,#81c784);
}
.fill-style {
  height:100%;
  background:linear-gradient(90deg,#d81b60,#f48fb1);
}

.badges span {
  margin-right:4px;
}
</style>
</head>

<body>

<h1>üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar‚Ä¶">
  <select id="mode">
    <option value="overall">Overall</option>
    <option value="engaging">Engaging</option>
    <option value="curious">Curious</option>
    <option value="humorous">Humorous</option>
    <option value="supportive">Supportive</option>
    <option value="dominant">Dominant</option>
    <option value="combative">Combative</option>
    <option value="flirty">Flirty</option>
    <option value="sexual">Sexual</option>
    <option value="curse">Curse</option>
  </select>
</div>

<table>
<thead>
<tr>
  <th class="sticky rank">#</th>
  <th class="sticky name">Name</th>
  <th>Confidence</th>
  <th>Summary</th>

  <th class="trait">Engaging</th>
  <th class="trait">Curious</th>
  <th class="trait">Humorous</th>
  <th class="trait">Supportive</th>
  <th class="trait">Dominant</th>
  <th class="trait">Combative</th>

  <th class="style">Flirty</th>
  <th class="style">Sexual</th>
  <th class="style">Curse</th>

  <th class="troll">Risk</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA=[], MODE="overall";

fetch(API).then(r=>r.json()).then(d=>{ DATA=d; render(); });

search.oninput = render;
mode.onchange = e => { MODE=e.target.value; render(); };

function bar(v,max,cls){
  let pct = max ? Math.round((v/max)*100) : v;
  return `<div class="bar"><div class="${cls}" style="width:${pct}%"></div></div>${pct}%`;
}

function render(){
  let q = search.value.toLowerCase();
  let list = DATA.filter(p=>p.name.toLowerCase().includes(q));

  if(MODE!=="overall"){
    let max = Math.max(...list.map(p=>p.traits?.[MODE]||p.styles?.[MODE]||0),1);
    list = list.filter(p=>(p.traits?.[MODE]||p.styles?.[MODE])>0)
               .sort((a,b)=>(b.traits?.[MODE]||b.styles?.[MODE])-(a.traits?.[MODE]||a.styles?.[MODE]));
    draw(list,max);
  } else {
    draw(list,0);
  }
}

function draw(list,max){
  rows.innerHTML="";
  list.forEach((p,i)=>{
    let t=p.traits||{}, s=p.styles||{};
    let trollIcon = p.troll ? "üî¥" : "üü¢";

    rows.innerHTML+=`
<tr>
<td class="sticky rank">${i+1}</td>
<td class="sticky name">${p.name}</td>
<td>${p.confidence}%</td>
<td class="summary">
  ${p.summary || ""}
  <div class="badges">
    ${(p.culture_badges||[]).map(b=>`<span>${b}</span>`).join("")}
  </div>
</td>

<td>${bar(t.engaging||0,max,"fill-trait")}</td>
<td>${bar(t.curious||0,max,"fill-trait")}</td>
<td>${bar(t.humorous||0,max,"fill-trait")}</td>
<td>${bar(t.supportive||0,max,"fill-trait")}</td>
<td>${bar(t.dominant||0,max,"fill-trait")}</td>
<td>${bar(t.combative||0,max,"fill-trait")}</td>

<td>${bar(s.flirty||0,max,"fill-style")}</td>
<td>${bar(s.sexual||0,max,"fill-style")}</td>
<td>${bar(s.curse||0,max,"fill-style")}</td>

<td class="troll">${trollIcon}</td>
</tr>`;
  });
}
</script>

</body>
</html>
