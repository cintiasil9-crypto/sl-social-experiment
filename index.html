<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üèÜ SL Social Experiment Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}

/* ===== HEAD ===== */
h1 {
  text-align: center;
  margin-bottom: 8px;
}

/* ===== CONTROLS ===== */
.controls, .lens {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 12px;
  align-items: center;
}

input, select, button {
  padding: 7px 10px;
  font-size: 14px;
}

button {
  cursor: pointer;
  border: none;
  background: #444;
  color: #fff;
  border-radius: 4px;
}
button:hover { background:#000; }

.lens button {
  background:#607d8b;
}
.lens button:hover {
  background:#37474f;
}

#backBtn { display:none; background:#1976d2; }
#compareToggle { background:#6a1b9a; }

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  font-size: 13px;
  white-space: nowrap;
}

th {
  position: sticky;
  top: 0;
  z-index: 3;
}

/* Sticky columns */
.sticky { position: sticky; background:#fff; z-index:2; }
.sticky.rank { left:0; }
.sticky.name { left:40px; }
.sticky.role { left:240px; }

/* Column groups */
.stats { background:#e3f2fd; }
.identity { background:#ede7f6; cursor:pointer; }
.trait { background:#e8f5e9; }
.style { background:#fce4ec; }
.troll { background:#ffebee; text-align:center; }

/* Bars */
.bar {
  height: 8px;
  background: #ccc;
  border-radius: 4px;
  overflow: hidden;
}
.fill-trait {
  height:100%;
  background: linear-gradient(90deg,#43a047,#81c784);
}
.fill-style {
  height:100%;
  background: linear-gradient(90deg,#d81b60,#f48fb1);
}

/* States */
.forming { opacity:0.75; font-style:italic; }
.selected { outline: 3px solid #ff9800; }
</style>
</head>

<body>

<h1 id="title">üèÜ SL Social Experiment Leaderboard</h1>

<div class="controls">
  <input id="search" placeholder="Search avatar‚Ä¶">
  <select id="mode">
    <option value="overall">Overall</option>
    <option value="engaging">Engaging</option>
    <option value="curious">Curious</option>
    <option value="humorous">Humorous</option>
    <option value="supportive">Supportive</option>
    <option value="dominant">Dominant</option>
    <option value="combative">Combative</option>
    <option value="flirty">Flirty</option>
    <option value="sexual">Sexual</option>
    <option value="curse">Curse</option>
  </select>

  <button id="backBtn">‚¨Ö Back</button>
  <button id="compareToggle">Compare</button>
</div>

<div class="lens">
  <button onclick="setMode('overall')">Overall</button>
  <button onclick="setMode('engaging')">Engaging</button>
  <button onclick="setMode('supportive')">Supportive</button>
  <button onclick="setMode('dominant')">Dominant</button>
  <button onclick="setMode('flirty')">Flirty</button>
  <button onclick="setMode('troll')">Troll Watch</button>
</div>

<table>
<thead>
<tr>
  <th class="sticky rank" title="Leaderboard rank">#</th>
  <th class="sticky name" title="Avatar name">Name</th>

  <th class="stats" title="How much data we have">Confidence</th>
  <th class="stats" title="Net positive social signal">Reputation</th>
  <th class="stats" title="How much others respond to you">Gravity</th>

  <th class="sticky role identity" title="Participation style">Role</th>
  <th class="identity" title="Dominant social pattern">Archetype</th>

  <th class="trait">Engaging</th>
  <th class="trait">Curious</th>
  <th class="trait">Humorous</th>
  <th class="trait">Supportive</th>
  <th class="trait">Dominant</th>
  <th class="trait">Combative</th>

  <th class="style">Flirty</th>
  <th class="style">Sexual</th>
  <th class="style">Curse</th>

  <th class="troll" title="Disruptive behavior pattern">Troll</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<script>
const API = "https://sl-gpt-relay.onrender.com/leaderboard";
let DATA=[], MODE="overall", COMPARE=false, SELECTED=new Set();

fetch(API).then(r=>r.json()).then(d=>{DATA=d; render();});

search.oninput = render;
mode.onchange = e=>setMode(e.target.value);
backBtn.onclick = ()=>setMode("overall");
compareToggle.onclick = ()=>{COMPARE=!COMPARE; render();};

function setMode(m){
  MODE=m;
  mode.value=m;
  backBtn.style.display = m==="overall"?"none":"inline-block";
  title.innerText = m==="overall" ? "üèÜ SL Social Experiment Leaderboard" : "üèÜ "+m.toUpperCase();
  render();
}

function bar(v,max,cls){
  let pct = max? Math.round((v/max)*100):0;
  return `<div class="bar"><div class="${cls}" style="width:${pct}%"></div></div>${pct}%`;
}

function render(){
  let q = search.value.toLowerCase();
  let list = DATA.filter(p=>p.name.toLowerCase().includes(q));

  if (MODE!=="overall" && MODE!=="troll"){
    let max = Math.max(...list.map(p=>p.traits?.[MODE]||p.styles?.[MODE]||0),1);
    list = list.filter(p=>(p.traits?.[MODE]||p.styles?.[MODE])>0)
               .sort((a,b)=>(b.traits?.[MODE]||b.styles?.[MODE])-(a.traits?.[MODE]||a.styles?.[MODE]));
    draw(list,max);
  } else {
    draw(list,0);
  }
}

function draw(list,max){
  rows.innerHTML="";
  list.forEach((p,i)=>{
    let t=p.traits||{}, s=p.styles||{};
    let troll = p.troll_score||0;
    let trollIcon = troll>0.7?"üî¥":troll>0.4?"üü°":"üü¢";

    rows.innerHTML+=`
<tr class="${p.archetype==="Profile forming"?"forming":""} ${SELECTED.has(p.name)?"selected":""}"
onclick="${COMPARE?`toggleSelect('${p.name}')`:""}">
<td class="sticky rank">${i+1}</td>
<td class="sticky name">${p.name}</td>

<td class="stats">${p.confidence}%</td>
<td class="stats">${p.reputation}%</td>
<td class="stats">${p.gravity}%</td>

<td class="sticky role identity">${p.role}</td>
<td class="identity" onclick="filterArch('${p.archetype}')">${p.archetype}</td>

<td class="trait">${bar(t.engaging||0,max,"fill-trait")}</td>
<td class="trait">${bar(t.curious||0,max,"fill-trait")}</td>
<td class="trait">${bar(t.humorous||0,max,"fill-trait")}</td>
<td class="trait">${bar(t.supportive||0,max,"fill-trait")}</td>
<td class="trait">${bar(t.dominant||0,max,"fill-trait")}</td>
<td class="trait">${bar(t.combative||0,max,"fill-trait")}</td>

<td class="style">${bar(s.flirty||0,max,"fill-style")}</td>
<td class="style">${bar(s.sexual||0,max,"fill-style")}</td>
<td class="style">${bar(s.curse||0,max,"fill-style")}</td>

<td class="troll">${trollIcon}</td>
</tr>`;
  });
}

function filterArch(a){
  search.value="";
  rows.innerHTML="";
  draw(DATA.filter(p=>p.archetype===a),0);
}

function toggleSelect(n){
  SELECTED.has(n)?SELECTED.delete(n):SELECTED.add(n);
  draw(DATA.filter(p=>!COMPARE||SELECTED.has(p.name)),0);
}
</script>

</body>
</html>
